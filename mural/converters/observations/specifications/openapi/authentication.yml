security: 
  BearerAuth: []
paths:
  /authentication:
    post:
      tags: 
        - authentication
      summary: Returns JWT authentication token based on accurate login information that can be included in request headers to access restricted routes
      operationId: postAuthToken
      description: Creates a new JWT token and allows the user to use restricted paths
      requestBody:
        $ref: '#/components/requestBodies/Authentication'
      security: []
      responses:
        '201':
          $ref: '#/components/responses/Authentication'
        '401':
          description: authentication error
          content:
            application/json:
              schema:
                $ref: "./errors.yml#/components/schemas/Error"
              examples:
                authentication_login_error:
                  $ref: "#/components/examples/authentication_login_error"
        default:
          description: login error
          content:
            application/json:
              schema:
                $ref: "./errors.yml#/components/schemas/Error"
              examples:
                authentication_login_error:
                  $ref: "#/components/examples/authentication_login_error"
components: 
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  requestBodies:
    Authentication:
      description: Authenticate api requests
      content:
        application/json:
          schema:
            type: object
            required:
              - strategy
              - clientKey
              - clientSecret
            properties:
              strategy:
                type: string
                example: local
              clientKey:
                type: string
                example: keyUsedForTesting
              clientSecret:
                type: string
                example: passwordUsedForTesting
  responses:
    Authentication:
      description: JWT created
      content:
        application/json:
          schema:
            type: object
            required:
              - accessToken
              - authentication
              - key
            properties:
              accessToken:
                type: string
                example: "uoiiopuiopiUzI1NiIsInR5cCI6ImFjY2VzcyJ9"
              authentication:
                type: object
                properties:
                  strategy:
                    type: string
                    example: local
                  accessToken:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6ImFjY2VzcyJ9
                  payload:
                    type: object
                    properties:
                      iat:
                        type: string
                        example: 1621287175
                      exp:
                        type: string
                        example: 1621373575
                      aud:
                        type: string
                        example: https://yourdomain.com
                      iss:
                        type: string
                        example: feathers
                      sub:
                        type: string
                        example: 1
                      jti:
                        type: string
                        example: e22bac05-bea6-4169-a839-cad4cfab22ce
          examples:
            authentication_default:
              $ref: "#/components/examples/authentication_default"
  examples:
    authentication_default:
      value:
        accessToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6ImFjY2VzcyJ9"
        authentication:
          strategy: local
          accessToken: eyJhbGciOiJIUzI1NiIsInR5cCI6ImFjY2VzcyJ9
          payload:
            iat: 1621287175
            exp: 1621373575
            aud: https://yourdomain.com
            iss: feathers
            sub: 1
            jti: e22bac05-bea6-4169-a839-cad4cfab22ce
            key:
              $ref: "./keys.yml#/components/schemas/Key"
    authentication_login_error:
      value:
        name: NotAuthenticated
        message: 'Not Authenticated'
        code: 401
        className: not-authenticated
        data: {}
        errors:
          - { message: 'Invalid authentication information (strategy not allowed in authStrategies)' }
          - { message: 'Invalid login' }